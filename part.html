<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>规则配置5</title>
    <!--#include file="/common/head.html"-->
    <style>
        .J_repeatPartTip{
            color: red;
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <div class="bd_DW">
        <div class="bd_field_delete_block J_partition">
            <span>【分区选择】</span>
            <button type="button" class="didi-btn didi-btn-ok margin-left-30 J_addPartition"> 添加 </button>
            <div class="rule-list-style J_partList">
                <!--<div class="rule-item J_partListItem">-->
                    <!--<i class="glyphicon glyphicon-minus-sign del-rule J_delPart"></i>-->
                    <!--<input type="text" class="bd_DW_input_len_300 J_partInp" placeholder="请输入分区名" value="">-->
                    <!--<input type="text" class="bd_DW_input_len_300 J_formatInp" placeholder="请输入格式" value="">-->
                    <!--<span class="J_repeatPartTip"></span>-->
                <!--</div>-->
                <p class="no-content-tip J_tip">暂无内容</p>
            </div>
            <button type="button" class="didi-btn didi-btn-ok margin-left-30 J_submit"> 提交 </button>
        </div>
    </div>
    <script>
        $(document).ready(function(){
            //添加分区选择模板
            $(document).on('click', '.J_addPartition', function () {
                 addPartition();
            });
            function addPartition() {
                var
                    tipEl,
                    lastPartItem;
                //清除“暂无内容”
                if ($(".J_tip" ,".J_partList").length != 0){
                    $(".J_tip" ,".J_partList").remove();
                }
                if($(".J_partListItem", ".J_partList").length != 0){
                    lastPartItem = $(".J_partListItem").last();
                    //缺一不可添加
                    if(($('.J_partInp', lastPartItem).val() == '') || ($('.J_formatInp', lastPartItem).val() == '')){
                        tipEl = $(".J_repeatPartTip", lastPartItem);
                        tipEl.text("请先完成此添加");
                        setTimeout(function () {
                            tipEl.text("");
                        }, 1000);
                    }else{
                        createListItem();
                    }
                }else{
                    createListItem();
                }
            }
            //提交
            $(document).on('click', '.J_submit', function () {
                var
                    partInpVal,
                    formatInpVal,
                    itemVal={},
                    listItem = $(".J_partListItem",".J_partList");

                if(listItem.length != 0){
                    $(listItem).each(function (index, item) {
                        partInpVal = $(".J_partInp", item).val();
                        formatInpVal = $(".J_formatInp", item).val();
                        if((partInpVal != "") && (formatInpVal != "")){
                            itemVal[partInpVal] = formatInpVal;
                        }
                    });
                    console.log(typeof itemVal);
                }
                console.log(typeof itemVal);
            });
            function createListItem() {
                var str = '<div class="rule-item J_partListItem">'+
                    '<i class="glyphicon glyphicon-minus-sign del-rule J_delPart"></i> '+
                    '<input type="text" class="bd_DW_input_len_300 J_partInp" placeholder="请输入分区名" value="">  '+
                    '<input type="text" class="bd_DW_input_len_300 J_formatInp" placeholder="请输入格式" value="">'+
                    '<span class="J_repeatPartTip"></span>'+
                    '</div>';
                $(".J_partList").append(str);
            }
            //删除
            $(document).on('click', '.J_delPart', function (e) {
                var
                    delItem = $(e.target).parents('.J_partListItem');
                $(delItem).remove();
                if($(".J_partListItem", ".J_partList").length == 0){
                    $(".J_partList").append('<p class="no-content-tip J_tip">暂无内容</p>');
                }
            });
        })
    </script>
</body>
</html>